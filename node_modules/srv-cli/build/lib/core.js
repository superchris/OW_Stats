'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = srv;

var _express = require('express');

var _express2 = _interopRequireDefault(_express);

var _morgan = require('morgan');

var _morgan2 = _interopRequireDefault(_morgan);

var _logger = require('./logger');

var _logger2 = _interopRequireDefault(_logger);

var _cors = require('./cors');

var _cors2 = _interopRequireDefault(_cors);

var _middleware = require('./middleware');

var _middleware2 = _interopRequireDefault(_middleware);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function srv(fn, opt) {
  // Express app.
  var app = (0, _express2.default)();

  // Hook in middleware if provided export.
  if (fn) (0, _middleware2.default)(fn.middleware, app);

  // Winston logging.
  var log = (0, _logger2.default)(opt.logging);
  app.use((0, _morgan2.default)('combined', { stream: log.stream }));
  app.log = log.logger; // Add to express app context.

  // CORS rules.
  var origin = (0, _cors2.default)(opt.cors);
  app.use(origin.cors);

  // Base routes.
  app.get('/health-check', function (req, res) {
    res.send('HTTP OK');
  });

  // Static Documentation.
  app.use('/docs', _express2.default.static('docs'));

  // Add mod instance.
  if (typeof fn === 'function') {
    fn(app);
  } else if (fn && typeof fn.default === 'function') {
    fn.default(app);
  }

  return app;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvcmUuanMiXSwibmFtZXMiOlsic3J2IiwiZm4iLCJvcHQiLCJhcHAiLCJtaWRkbGV3YXJlIiwibG9nIiwibG9nZ2luZyIsInVzZSIsInN0cmVhbSIsImxvZ2dlciIsIm9yaWdpbiIsImNvcnMiLCJnZXQiLCJyZXEiLCJyZXMiLCJzZW5kIiwic3RhdGljIiwiZGVmYXVsdCJdLCJtYXBwaW5ncyI6Ijs7Ozs7a0JBUXdCQSxHOztBQVJ4Qjs7OztBQUNBOzs7O0FBRUE7Ozs7QUFDQTs7OztBQUNBOzs7Ozs7QUFHZSxTQUFTQSxHQUFULENBQWFDLEVBQWIsRUFBaUJDLEdBQWpCLEVBQXNCO0FBQ25DO0FBQ0EsTUFBTUMsTUFBTSx3QkFBWjs7QUFFQTtBQUNBLE1BQUlGLEVBQUosRUFBUSwwQkFBV0EsR0FBR0csVUFBZCxFQUEwQkQsR0FBMUI7O0FBRVI7QUFDQSxNQUFNRSxNQUFNLHNCQUFPSCxJQUFJSSxPQUFYLENBQVo7QUFDQUgsTUFBSUksR0FBSixDQUFRLHNCQUFPLFVBQVAsRUFBbUIsRUFBRUMsUUFBUUgsSUFBSUcsTUFBZCxFQUFuQixDQUFSO0FBQ0FMLE1BQUlFLEdBQUosR0FBVUEsSUFBSUksTUFBZCxDQVZtQyxDQVVaOztBQUV2QjtBQUNBLE1BQU1DLFNBQVMsb0JBQUtSLElBQUlTLElBQVQsQ0FBZjtBQUNBUixNQUFJSSxHQUFKLENBQVFHLE9BQU9DLElBQWY7O0FBRUE7QUFDQVIsTUFBSVMsR0FBSixDQUFRLGVBQVIsRUFBeUIsVUFBQ0MsR0FBRCxFQUFNQyxHQUFOLEVBQWM7QUFBRUEsUUFBSUMsSUFBSixDQUFTLFNBQVQ7QUFBc0IsR0FBL0Q7O0FBRUE7QUFDQVosTUFBSUksR0FBSixDQUFRLE9BQVIsRUFBaUIsa0JBQVFTLE1BQVIsQ0FBZSxNQUFmLENBQWpCOztBQUVBO0FBQ0EsTUFBSSxPQUFPZixFQUFQLEtBQWMsVUFBbEIsRUFBOEI7QUFDNUJBLE9BQUdFLEdBQUg7QUFDRCxHQUZELE1BRU8sSUFBSUYsTUFBTSxPQUFPQSxHQUFHZ0IsT0FBVixLQUFzQixVQUFoQyxFQUE0QztBQUNqRGhCLE9BQUdnQixPQUFILENBQVdkLEdBQVg7QUFDRDs7QUFFRCxTQUFPQSxHQUFQO0FBQ0QiLCJmaWxlIjoiY29yZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBleHByZXNzIGZyb20gJ2V4cHJlc3MnO1xyXG5pbXBvcnQgbW9yZ2FuIGZyb20gJ21vcmdhbic7XHJcblxyXG5pbXBvcnQgbG9nZ2VyIGZyb20gJy4vbG9nZ2VyJztcclxuaW1wb3J0IGNvcnMgZnJvbSAnLi9jb3JzJztcclxuaW1wb3J0IG1pZGRsZXdhcmUgZnJvbSAnLi9taWRkbGV3YXJlJztcclxuXHJcblxyXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBzcnYoZm4sIG9wdCkge1xyXG4gIC8vIEV4cHJlc3MgYXBwLlxyXG4gIGNvbnN0IGFwcCA9IGV4cHJlc3MoKTtcclxuXHJcbiAgLy8gSG9vayBpbiBtaWRkbGV3YXJlIGlmIHByb3ZpZGVkIGV4cG9ydC5cclxuICBpZiAoZm4pIG1pZGRsZXdhcmUoZm4ubWlkZGxld2FyZSwgYXBwKTtcclxuXHJcbiAgLy8gV2luc3RvbiBsb2dnaW5nLlxyXG4gIGNvbnN0IGxvZyA9IGxvZ2dlcihvcHQubG9nZ2luZyk7XHJcbiAgYXBwLnVzZShtb3JnYW4oJ2NvbWJpbmVkJywgeyBzdHJlYW06IGxvZy5zdHJlYW0gfSkpO1xyXG4gIGFwcC5sb2cgPSBsb2cubG9nZ2VyOyAgLy8gQWRkIHRvIGV4cHJlc3MgYXBwIGNvbnRleHQuXHJcblxyXG4gIC8vIENPUlMgcnVsZXMuXHJcbiAgY29uc3Qgb3JpZ2luID0gY29ycyhvcHQuY29ycyk7XHJcbiAgYXBwLnVzZShvcmlnaW4uY29ycyk7XHJcblxyXG4gIC8vIEJhc2Ugcm91dGVzLlxyXG4gIGFwcC5nZXQoJy9oZWFsdGgtY2hlY2snLCAocmVxLCByZXMpID0+IHsgcmVzLnNlbmQoJ0hUVFAgT0snKTsgfSk7XHJcblxyXG4gIC8vIFN0YXRpYyBEb2N1bWVudGF0aW9uLlxyXG4gIGFwcC51c2UoJy9kb2NzJywgZXhwcmVzcy5zdGF0aWMoJ2RvY3MnKSk7XHJcblxyXG4gIC8vIEFkZCBtb2QgaW5zdGFuY2UuXHJcbiAgaWYgKHR5cGVvZiBmbiA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgZm4oYXBwKTtcclxuICB9IGVsc2UgaWYgKGZuICYmIHR5cGVvZiBmbi5kZWZhdWx0ID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICBmbi5kZWZhdWx0KGFwcCk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gYXBwO1xyXG59XHJcbiJdfQ==